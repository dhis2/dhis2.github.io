<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>config/field-rules.js - Postman Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addQuery">addQuery</a></li><li><a href="global.html#createModelToEditEpic">createModelToEditEpic</a></li><li><a href="global.html#createStepperContentFromConfig">createStepperContentFromConfig</a></li><li><a href="global.html#createStepperFromConfig">createStepperFromConfig</a></li><li><a href="global.html#deleteProgramStageFromState">deleteProgramStageFromState</a></li><li><a href="global.html#findHelpLinkForPath">findHelpLinkForPath</a></li><li><a href="global.html#getDocsVersion">getDocsVersion</a></li><li><a href="global.html#removeQuery">removeQuery</a></li><li><a href="global.html#replaceMappingPathPlaceholder">replaceMappingPathPlaceholder</a></li><li><a href="global.html#replacePlaceholder">replacePlaceholder</a></li><li><a href="global.html#ReportDateToUseDropDown">ReportDateToUseDropDown</a></li><li><a href="global.html#typeDetails">typeDetails</a></li><li><a href="global.html#withProgramAndStages">withProgramAndStages</a></li><li><a href="global.html#withProgramStageFromProgramStage$">withProgramStageFromProgramStage$</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">config/field-rules.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Rules for the form fields.
 * If multiple `when` objects are specified these are evaluated as an OR.
 * The following would result check if either of the statements return true
 * ```
 when: [{
        field: 'valueType',
        operator: 'ONEOF',
        value: [
            'TEXT',
            'LONG_TEXT',
            'LETTER',
            'PHONE_NUMBER',
            'EMAIL',
            'TRACKER_ASSOCIATE',
            'USERNAME',
            'FILE_RESOURCE',
            'COORDINATE',
        ]
        }, {
            field: 'domainType',
            operator: 'EQUALS',
            value: 'TRACKER',
        }],
 * ```
 */
export default new Map([
    ['dataElement', [
        {
            field: 'domainType',
            when: {
                operator: 'EQUALS',
                value: 'TRACKER',
            },
            operations: [{
                field: 'categoryCombo',
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }],
        },
        {
            field: 'valueType',
            when: {
                field: 'optionSet',
                operator: 'HAS_VALUE',
            },
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }, {
                type: 'CHANGE_VALUE',
                // TODO: This function does a mutable modification. It is more efficient this way however it might
                // collide and is not very transparent. Especially the fact that the new value needs to be set
                // on both the model and the fieldConfig is not very clear.
                // It would probably make sense to run the model modification rules before sending the values to
                // the FormBuilder.
                setValue: (model, fieldConfig) => {
                    // Do not not change the valueType when there is no optionSet or when there is no valueType
                    // for the optionSet (which can occur during the initial run of the rules)
                    if (model.optionSet &amp;&amp; model.optionSet.valueType) {
                        // Update the fieldConfig to contain the correct value
                        fieldConfig.value = model.optionSet.valueType;

                        // Update the model only when the value is not the same as the current
                        if (model[fieldConfig.name] !== model.optionSet.valueType) {
                            model[fieldConfig.name] = model.optionSet.valueType;
                        }
                    }
                },
            }],
        },
        {
            field: 'aggregationType',
            when: {
                field: 'valueType',
                operator: 'ONEOF',
                value: [
                    'TEXT',
                    'LONG_TEXT',
                    'LETTER',
                    'PHONE_NUMBER',
                    'EMAIL',
                    'TRACKER_ASSOCIATE',
                    'USERNAME',
                    'FILE_RESOURCE',
                    'COORDINATE',
                ],
            },
            operations: [{
                field: 'aggregationType',
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }, {
                field: 'aggregationType',
                type: 'CHANGE_VALUE',
                setValue: (model, fieldConfig) => {
                    fieldConfig.value = model[fieldConfig.name] = 'NONE';
                },
            }],
        },
    ]],
    ['dataSetNotificationTemplate', [
        {
            when: [{
                field: 'dataSetNotificationTrigger',
                operator: 'NOT_EQUALS',
                value: 'SCHEDULED_DAYS',
            }],
            operations: [
                {
                    field: 'relativeScheduledDays',
                    type: 'HIDE_FIELD',
                },
                {
                    field: 'sendStrategy',
                    type: 'HIDE_FIELD',
                },
            ],
        },
    ]],
    ['attribute', [
        {
            field: 'valueType',
            when: {
                field: 'optionSet',
                operator: 'HAS_VALUE',
            },
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }, {
                type: 'CHANGE_VALUE',
                setValue: (model, fieldConfig) => {
                    fieldConfig.value = model[fieldConfig.name] = model.optionSet.valueType;
                },
            }],
        },
    ]],
    ['trackedEntityAttribute', [
        {
            field: 'valueType',
            when: [{
                operator: 'ONEOF',
                value: [
                    'BOOLEAN',
                    'TRUE_ONLY',
                    'DATE',
                    'TRACKER_ASSOCIATE',
                    'USERNAME',
                    'OPTION_SET',
                ],
            }],
            operations: [{
                field: 'unique',
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }, {
                field: 'unique',
                type: 'CHANGE_VALUE',
                setValue: (model, fieldConfig) => {
                    fieldConfig.value = model[fieldConfig.property] = false;
                },
            }],
        },
        {
            field: 'valueType',
            when: {
                field: 'optionSet',
                operator: 'HAS_VALUE',
            },
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }, {
                type: 'CHANGE_VALUE',
                setValue: (model, fieldConfig) => {
                    fieldConfig.value = model[fieldConfig.name] = model.optionSet.valueType;
                },
            }],
        },
    ]],
    ['externalMapLayer', [
        {
            // When legendSet has value, clear and disable the legendSetUrl field
            field: 'legendSetUrl',
            when: [{
                field: 'legendSet',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                field: 'legendSetUrl',
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }],
        },
        {
            // When legendSetUrl has value, clear and disable the legendSet field
            field: 'legendSet',
            when: [{
                field: 'legendSetUrl',
                operator: 'HAS_STRING_VALUE',
            }],
            operations: [{
                field: 'legendSet',
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }],
        },
    ]],
    ['organisationUnit', [
        {
            field: 'dataSets',
            when: [{
                operator: 'SYSTEM_SETTING_IS_FALSE',
                value: 'keyAllowObjectAssignment',
            }],
            operations: [{
                field: 'dataSets',
                type: 'HIDE_FIELD',
            }],
        },
        {
            field: 'featureType',
            when: [{
                field: 'coordinates',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'CHANGE_VALUE',
                setValue: (model) => {
                    // TODO: this is almost the same check as in the coordinate-field we should DRY these up.
                    const isValidPoint = (value) => {
                        try {
                            const poly = JSON.parse(value);
                            return Array.isArray(poly) &amp;&amp; (poly.length === 0 || (poly.length === 2 &amp;&amp; !isNaN(poly[0]) &amp;&amp; !isNaN(poly[1])));
                        } catch (e) {
                        }

                        return false;
                    };

                    // If we have valid coordinates set the the featureType to POINT
                    if (model.coordinates) {
                        // Set the correct featureType if we're dealing with a point otherwise
                        // keep the featureType the same as it was since we're not dealing with a point
                        if (isValidPoint(model.coordinates)) {
                            model.featureType = 'POINT';
                        }
                    } else {
                        // The user might have removed the coordinates so we'll reset the featureType to `null`
                        model.featureType = null;
                    }
                },
            }],
        },
    ]],
    ['programRule', [
        {
            field: 'name',
            when: [{
                field: 'program',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: false,
                elseValue: true,
            }],
        },
        {
            field: 'description',
            when: [{
                field: 'program',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: false,
                elseValue: true,
            }],
        },
        {
            field: 'priority',
            when: [{
                field: 'program',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: false,
                elseValue: true,
            }],
        },
        {
            field: 'condition',
            when: [{
                field: 'program',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: false,
                elseValue: true,
            }],
        },
        {
            field: 'programRuleActions',
            when: [{
                field: 'program',
                operator: 'HAS_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: false,
                elseValue: true,
            }],
        },
    ]],
    ['programRuleVariable', [
        {
            field: 'program',
            when: [{
                field: 'dataElement',
                operator: 'HAS_STRING_VALUE',
            }, {
                field: 'trackedEntityAttribute',
                operator: 'HAS_STRING_VALUE',
            }, {
                field: 'programStage',
                operator: 'HAS_STRING_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }],
        },
        {
            field: 'dataElement',
            when: [{
                field: 'programRuleVariableSourceType',
                operator: 'ONEOF',
                value: [
                    'CALCULATED_VALUE',
                    'TEI_ATTRIBUTE',
                ],
            }],
            operations: [{
                field: 'dataElement',
                type: 'HIDE_FIELD',
            }],
        },
        {
            field: 'trackedEntityAttribute',
            when: [{
                field: 'programRuleVariableSourceType',
                operator: 'NOT_EQUALS',
                value: 'TEI_ATTRIBUTE',
            }],
            operations: [{
                field: 'trackedEntityAttribute',
                type: 'HIDE_FIELD',
            }],
        },
        {
            field: 'programStage',
            when: [{
                field: 'programRuleVariableSourceType',
                operator: 'NOT_EQUALS',
                value: 'DATAELEMENT_NEWEST_EVENT_PROGRAM_STAGE',
            }],
            operations: [{
                field: 'programStage',
                type: 'HIDE_FIELD',
            }],
        },
        {
            field: 'programStage',
            when: [{
                field: 'dataElement',
                operator: 'HAS_STRING_VALUE',
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false,
            }],
        },
    ]],
    ['programStage', [
        {
            field: 'autoGenerateEvent',
            when: [{
                field: 'autoGenerateEvent',
                operator: 'NOT_EQUALS',
                value: true
            }],
            operations: [{
                field: 'openAfterEnrollment',
                type: 'HIDE_FIELD'
            }, {
                field: 'reportDateToUse',
                type: 'HIDE_FIELD'
            }]
        },
        {
            field: 'reportDateToUse',
            when: [{
                field: 'openAfterEnrollment',
                operator: 'NOT_EQUALS',
                value: true
            }],
            operations: [{
                type: 'SET_PROP',
                propName: 'disabled',
                thenValue: true,
                elseValue: false
            }]
        }
    ]],
    ['enrollment', [
        {
            field: 'relationshipType',
            when: [{
                field: 'relationshipType',
                operator: 'HAS_NO_VALUE',
            }],
            operations: [{
                field: 'relationshipFromA',
                type: 'HIDE_FIELD'
            }, {
                field: 'relationshipText',
                type: 'HIDE_FIELD'
            }, {
                field: 'relatedProgram',
                type: 'HIDE_FIELD'
            }]
        }
    ]]
]);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated at Thu Feb 08 2018 15:42:25 GMT+0000 (UTC)
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
