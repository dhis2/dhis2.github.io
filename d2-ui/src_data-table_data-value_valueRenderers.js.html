<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>src/data-table/data-value/valueRenderers.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Action.html">Action</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AsyncValidatorRunner.html">AsyncValidatorRunner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AsyncValidatorRunner.html#.create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AsyncValidatorRunner.html#listenToValidatorsFor">listenToValidatorsFor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AsyncValidatorRunner.html#run">run</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ControlBar.html">ControlBar</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FormField.html">FormField</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Sharing.html">Sharing</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SharingDialog.html">SharingDialog</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-lib_utils.html">lib/utils</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#addValueRenderer">addValueRenderer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#create">create</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createActionsFromNames">createActionsFromNames</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#decrementMemberCount">decrementMemberCount</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#findValueRenderer">findValueRenderer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#forEachOnPath">forEachOnPath</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getAllObjectsWithFields">getAllObjectsWithFields</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getSearchResultsHeight">getSearchResultsHeight</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#incrementMemberCount">incrementMemberCount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mergeChildren">mergeChildren</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#removeMenuManagementModule">removeMenuManagementModule</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#runValidatorFunctions">runValidatorFunctions</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#selector">selector</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#typeDetails">typeDetails</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">src/data-table/data-value/valueRenderers.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import PropTypes from 'prop-types';
import React, { PureComponent } from 'react';
import { isNil } from 'lodash/fp';
import Color from './Color.component';
import Translate from '../../i18n/Translate.component';

function TextValue({ value = '' }) {
    const textWrapStyle = {
        width: '100%',
        textOverflow: 'ellipsis',
        overflow: 'hidden',
        whiteSpace: 'nowrap',
        position: 'absolute',
        wordBreak: 'break-all',
        wordWrap: 'break-word',
        top: 0,
        lineHeight: '50px',
        paddingRight: '1rem',
    };

    const displayValue = value.toString();

    return (&lt;span title={displayValue} style={textWrapStyle} >{displayValue}&lt;/span>);
}

function getDateToShowInList(value, locale = 'en') {
    if (isNil(value)) {
        return '';
    }

    if (typeof global.Intl !== 'undefined' &amp;&amp; Intl.DateTimeFormat) {
        return new Intl.DateTimeFormat(locale, { year: 'numeric', month: 'long', day: 'numeric' }).format(new Date(value));
    }

    return value.substr(0, 19).replace('T', ' ');
}

class DateValue extends PureComponent {
    constructor(props, context) {
        super(props, context);

        this.state = {
            uiLocale: 'en',
        };
    }

    componentDidMount() {
        // Get the locale from the userSettings
        this.context.d2.currentUser.userSettings
            .get('keyUiLocale')
            .then(uiLocale => this.setState({ uiLocale }));
    }

    render() {
        const displayDate = getDateToShowInList(this.props.value, this.state.uiLocale);

        return (
            &lt;TextValue value={displayDate} />
        );
    }
}
DateValue.contextTypes = {
    d2: PropTypes.object,
};

function ObjectWithDisplayName(props) {
    const textValue = props.value &amp;&amp; (props.value.displayName || props.value.name);
    return (&lt;TextValue {...props} value={textValue} />);
}

const dhis2DateFormat = /^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}\.[0-9]{2,3}$/;
function isDateValue({ valueType, value }) {
    return valueType === 'DATE' || dhis2DateFormat.test(value);
}

function isColorValue({ value }) {
    return /#([a-z0-9]{6})$/i.test(value);
}

function isObjectWithDisplayName({ value }) {
    return value &amp;&amp; (value.displayName || value.name);
}

function PublicAccessValue({ value }) {
    if (value) {
        const metaData = value.substr(0, 2);
        const data = value.substr(2, 2);
        const other = value.substr(4, 4);

        if (other === '----' &amp;&amp; (data === '--' || data === 'r-' || data === 'rw')) {
            if (metaData === 'rw') {
                return &lt;Translate>public_can_edit&lt;/Translate>;
            } else if (metaData === 'r-') {
                return &lt;Translate>public_can_view&lt;/Translate>;
            } else if (metaData === '--') {
                return &lt;Translate>public_none&lt;/Translate>;
            }
        }
    }

    return &lt;TextValue value={value} />;
}

function isPublicAccess({ columnName }) {
    return columnName === 'publicAccess';
}

let valueRenderers = [
    [isPublicAccess, PublicAccessValue],
    [isDateValue, DateValue],
    [isObjectWithDisplayName, ObjectWithDisplayName],
    [isColorValue, Color],
];

/**
 * Register a new ValueRenderer. The value renderers are used to render different values in the DataTable. (e.g. colors should be rendered as a Color component).
 * The new renderer is added to the start of the renderer list. If your passed `checker` is too specific the `component` might be used for values that you might not want.
 * Passing `() => true` as a checker will result the passed `component` to be used for every value in the DataTable.
 *
 * @param {function} checker Check if the value is valid for the `component` to be rendered. This function receives an object with `value`, `valueType` and `columnName` that can be used to determine if this `component` should render the value.
 * @param {function} component A React component to render when the `checker` returns true. This is the component that will be returned from `findValueRenderer`.
 *
 * @returns {function} A de-register function to unregister the checker. If you want to remove the valueRenderer from the list of renderers you can use this function to undo the add.
 */
export function addValueRenderer(checker, component) {
    valueRenderers.unshift([checker, component]);

    /**
     * Un-register the valueRenderer
     */
    return function removeValueRenderer() {
        const rendererMap = new Map(valueRenderers);

        rendererMap.delete(checker);

        valueRenderers = Array.from(rendererMap);
    };
}

/**
 * This method is used by the DataTableRow component to find a ValueRenderer for the value that should be displayed in the table's cell.
 * It will recieve an object like the one below and loop through a list of renderers until it finds one that will handle this type of value.
 * ```json
 * {
 *   "value": "#FFFFFF",
 *   "valueType": "TEXT",
 *   "columnName": "color",
 * }
 * ```
 *
 * @param {object} valueDetails The value and its details. The object has the properties `columnName`, `value` and `valueType`.
 * @returns {function} The React component that can render a value for the passed `valueDetails`.
 */
export const findValueRenderer = (valueDetails) => {
    const valueCheckers = valueRenderers.map(([checker]) => checker);
    const checkerIndex = valueCheckers.findIndex(checker => checker(valueDetails));

    return (valueRenderers[checkerIndex] &amp;&amp; valueRenderers[checkerIndex][1]) || TextValue;
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 02 2018 11:39:29 GMT+0100 (CET) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
